% L1 = [95
%     96
%     98
%     99
%     100
%     102
%     120
%     140
%     147
%     209
%     470
%     471
%     488
%     492
%     519
%     520
%     610
%     707
%     730
%     738
%     772
%     959
%     1004
%     1005
%     1079
%     1081
%     1157
%     1158
%     1159
%     1160
%     1270
%     1279
%     1282
%     1283
%     1284
%     1304
%     1411
%     1487
%     1606
%     1647
%     1662
%     1676
%     1776
%     1777
%     1779
%     1780
%     1784
%     1840
%     1841
%     1842
%     1843
%     1844
%     1849
%     1851
%     1908
%     1945
%     1967
%     1968
%     1969
%     2048
%     2407
%     2408
%     2409
%     2410
%     2530
%     2582
%     2583
%     2586
%     2613];
% 
% load('datav3.mat')
% X(L1,:) = [];
% Y(L1,:) = [];
% 
% X = zscore(X(:,2:8));
% Y = zscore(Y(:,4));
% 
% c= 2.5;
% p=0.001;
% 
% asym(X,Y,c,p)



function[] = asym(X,Y,c,p)

figure(1)
scatter3(X(:,2), log(X(:,3)),Y)
hold on

% On cherche A tq X'*(exp(c*(Y-X*A))-1) = 0

f=@(A) X'*(exp(c*(Y-X*A))-1);
g=@(A) sqrt(sum(f(A).^2));
h=@(A) X'*((exp(c*(Y-X*A))*ones(1,size(X,2))).*X)*(f(A)/(2*g(A)));

A = (X'*X)\(X'*Y);
sum(h(A).^2);
scatter3(X(:,2), log(X(:,3)),X*A,'g')

while sum(h(A).^2)>p^2
    A = A - g(A)*h(A)/sum(h(A).^2);
    sum(h(A).^2);
end

scatter3(X(:,2), log(X(:,3)),X*A,'r')
hold off

sum(Y - X*A>0)
max(Y - X*A)



